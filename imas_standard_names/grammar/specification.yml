#===============================================================================
# IMAS Standard Name Grammar Specification
#===============================================================================
#
# This file is the single source of truth for the standard-name grammar used by
# the runtime parser and composer. Downstream Python types and metadata are
# auto-generated from this YAML during builds/installs.
#
# Generation details:
# - The generator lives at: imas_standard_names/grammar_codegen/generate.py
# - It writes: imas_standard_names/grammar/types.py
# - It runs automatically during package build via Hatch (see hatch_build_hooks.py)
# - A console entrypoint also exists in pyproject.toml: `build-grammar`
# - You can regenerate locally without building by running:
#     python -m imas_standard_names.grammar_codegen.generate
#
#===============================================================================
# Grammar Usage Notes
#===============================================================================
#
# Segment structure:
# - component/coordinate and subject are optional single tokens; 
#   geometric_base or physical_base is required (mutually exclusive).
#
# component (for physical vectors) vs coordinate (for geometric/spatial vectors):
#   * Use "component" for physical field vectors 
#     (magnetic_field, heat_flux, velocity) with physical_base
#     Template: {axis}_component_of_{vector} 
#     (e.g., radial_component_of_magnetic_field)
#   * Use "coordinate" for geometric/spatial quantities 
#     (position, vertex, centroid, trajectory) with geometric_base
#     Template: {axis}_{geometric_base} 
#     (e.g., radial_position_of_flux_loop_contour)
#   * component and coordinate are mutually exclusive
#   * coordinate requires geometric_base; component requires physical_base
#
# device (<device>_):
#   * Use prefix pattern for device signals/outputs where device IS the source
#     (e.g., flux_loop_voltage, passive_loop_current,
#      poloidal_magnetic_field_probe_voltage)
#   * For time-varying signals, measurements, or outputs FROM/THROUGH the device
#   * Shares objects vocabulary with object segment
#   * Mutually exclusive with of_object suffix
#
# object (of_<object>):
#   * Use "of_" suffix for intrinsic properties/characteristics OF the hardware
#     (e.g., area_of_flux_loop, position_of_poloidal_field_coil,
#      number_of_turns_of_passive_loop)
#   * For static properties: dimensions, configuration parameters, geometric attributes
#   * Shares objects vocabulary with device segment
#   * Mutually exclusive with device_ prefix
#
# device vs object distinction:
#   * device_<signal>: Dynamic signals/outputs (flux_loop_voltage)
#   * <property>_of_object: Static characteristics (area_of_flux_loop)
#   * For physics quantities measured BY devices, use generic names and
#     document measurement method in metadata (per fusion metadata conventions)
#
# geometry (of_<target>) vs position (at_<location>):
#   * Use "of_" for intrinsic properties/characteristics 
#     OF the geometric object itself
#     (e.g., major_radius_of_plasma_boundary, area_of_first_wall, 
#      curvature_of_flux_surface)
#   * Use "at_" for field quantities evaluated/sampled 
#     AT a spatial location
#     (e.g., electron_temperature_at_magnetic_axis, 
#      poloidal_flux_at_plasma_boundary)
#   * Same token can be used with both "of_" and "at_" 
#     depending on context
#   * geometry and position are mutually exclusive and appear side-by-side 
#     in the suffix order.
#
# Naming conventions:
# - do not include units in the name; use lowercase; start with a letter; 
#   use letters, digits, and underscores.
# - Discourage compound base names (e.g., poloidal_flux_boundary); 
#   prefer explicit position/geometry modifiers
#
#===============================================================================
# Canonical Pattern
#===============================================================================

canonical_pattern: >
  [<component>_component_of | <coordinate>]? 
  [<subject>]? 
  [<device>]?
  <geometric_base | physical_base> 
  [of_<object>]? 
  [of_<geometry> | at_<position>]? 
  [due_to_<process>]?

#===============================================================================
# Applicability: When to Create Standard Names
#===============================================================================

applicability:
  include:
    - >
      Conceptual definitions: plasma regions, boundaries, reference surfaces, 
      and operational modes
    - "Physical quantities: measurements, diagnostic signals, and derived calculations"
    - "Geometric quantities: spatial locations, shapes, dimensions, and extents"
    - "Hardware properties: physical characteristics and configuration parameters"
    - "Coordinate systems: time, spatial coordinates, and flux coordinates"
  exclude:
    - >
      Facility-specific identifiers and labels 
      (paths like */name, */identifier, */label)
    - "Type enumeration indices (paths like */type/index)"
    - "Code provenance metadata (paths like */code/*, */ids_properties/*)"
  rationale: >
    Standard names cover physical quantities with standardizable meaning and units, 
    as well as conceptual definitions that establish shared understanding of plasma regions, 
    boundaries, and reference coordinates across codes and diagnostics.

#===============================================================================
# Naming Guidance: Common Pitfalls to Avoid
#===============================================================================

naming_guidance:
  ambiguous_qualifiers:
    boundary_shape_parameters:
      rule: "Shape parameters need explicit qualifiers"
      examples: "Use elongation_of_plasma_boundary or elongation_of_flux_surface, not elongation"
      why: "IMAS DD has both boundary values and profile arrays"
    geometric_quantities:
      rule: "Always specify reference object or surface"
      examples: "Use minor_radius_of_plasma_boundary, not minor_radius"
      why: "Prevents confusion between scalar boundary values and profile data"

#===============================================================================
# Segment Definitions
#===============================================================================

segments:
  - id: component
    optional: true
    vocabulary: components
    template: "{token}_component_of"
    exclusive_with:
      - coordinate
    description: >
      Directional component of a physical vector quantity 
      (fields, fluxes, velocities)
  - id: coordinate
    optional: true
    vocabulary: components
    exclusive_with:
      - component
    description: >
      Coordinate axis for geometric/spatial vector decomposition 
      (position, vertex, centroid, trajectory, displacement)
  - id: subject
    optional: true
    vocabulary: subjects
    description: "Particle species or plasma population"
  - id: device
    optional: true
    vocabulary: objects
    exclusive_with:
      - object
    description: >
      Diagnostic hardware or actuator device producing/conducting the signal.
      Used for device signals and outputs where the device IS the source/conductor.
      Pattern: <device>_<signal> where signal is the physical_base.
      Examples: flux_loop_voltage (voltage from loop), 
      passive_loop_current (current through loop),
      poloidal_magnetic_field_probe_voltage (probe output),
      ion_cyclotron_heating_antenna_forward_power (antenna power).
      Distinction: device_ prefix for dynamic signals vs of_object suffix for static properties.
  - id: geometric_base
    optional: true
    vocabulary: geometric_bases
    exclusive_with:
      - physical_base
    description: >
      Geometric/spatial quantity describing locations, shapes, orientations, or spatial extents.
      Controlled vocabulary of geometric bases that represent WHERE something is or 
      the geometric structure of objects (position, vertex, centroid, displacement, etc.).
      Must be qualified with object or geometry segment to specify what is being described.
      Used with coordinate prefix for vector components (e.g., radial_position_of_flux_loop).
  - id: physical_base
    optional: true
    exclusive_with:
      - geometric_base
    description: >
      Physical quantity, measurement, or hardware property (open-ended).
      Can represent physical fields (magnetic_field, temperature, voltage, flux, current),
      derived quantities (gradient, divergence), measurement signals, 
      or hardware characteristics (area, resistance, capacitance).
      New physical base terms are defined through catalog entries, not the grammar.
      Used with component prefix for physical vector components (e.g., radial_component_of_magnetic_field).
  - id: object
    optional: true
    vocabulary: objects
    template: "of_{token}"
    exclusive_with:
      - device
    description: >
      Physical object, diagnostic hardware, or equipment whose intrinsic
      property or characteristic is described.
      Used for static properties: geometric dimensions, configuration parameters,
      physical attributes that define the object.
      Pattern: <property>_of_<object>
      Examples: area_of_flux_loop (loop dimension),
      position_of_poloidal_field_coil (coil location),
      number_of_turns_of_passive_loop (construction parameter).
      Distinction: of_object suffix for static properties vs device_ prefix for dynamic signals.
  - id: geometry
    optional: true
    vocabulary: positions
    template: "of_{token}"
    exclusive_with:
      - position
    description: >
      Intrinsic geometric property OF the object 
      (coordinates, dimensions, shapes that define it)
  - id: position
    optional: true
    vocabulary: positions
    template: "at_{token}"
    exclusive_with:
      - geometry
    description: >
      Field quantity evaluated AT the spatial location 
      (temperatures, densities, fluxes measured there)
  - id: process
    optional: true
    vocabulary: processes
    template: "due_to_{token}"
    description: "Physical mechanism or process contributing to the quantity"

#===============================================================================
# Vocabulary Sources
#===============================================================================
# Vocabularies can be defined inline or imported from external files
# External vocabulary files are in the vocabularies/ subdirectory

vocabularies:
  components: !include vocabularies/components.yml
  subjects: !include vocabularies/subjects.yml
  geometric_bases: !include vocabularies/geometric_bases.yml
  objects: !include vocabularies/objects.yml
  positions: !include vocabularies/positions.yml
  processes: !include vocabularies/processes.yml
  generic_physical_bases: !include vocabularies/generic_physical_bases.yml

#===============================================================================
# Catalog Entry Schema
#===============================================================================
# Defines required/optional fields, validation rules, and guidance for
# standard name catalog entries. Auto-generates:
# - Pydantic Field() descriptions and constraints (via codegen)
# - MCP tool guidance sections (via codegen)
# - Documentation templates and validation rules

entry_schema:
  fields:
    name:
      required: true
      type: string
      description: "Standard name token: snake_case (^[a-z][a-z0-9_]*$); starts with a letter; no double '__'."
      pattern: "^[a-z][a-z0-9_]*$"
      examples:
        - electron_temperature
        - gradient_of_electron_temperature
        - radial_component_of_magnetic_field
      guidance:
        validation: "Must follow grammar canonical pattern. Use get_naming_grammar for composition rules."
        common_mistakes:
          - "Including units in name (use unit field instead)"
          - "Using camelCase or spaces"
          - "Starting with underscore or digit"
    
    description:
      required: true
      type: string
      description: "One concise sentence summarizing the physical quantity. Keep under 120 characters for readability. Should be self-contained and understandable without external context."
      max_length: 180
      guidance:
        yaml_formatting: "Use plain unquoted style for simple text. Use single quotes if special characters needed."
        content_rules:
          - "Start with capital letter, end with period"
          - "Be specific and precise"
          - "Avoid jargon without definition"
        avoid:
          - "Repeating the name verbatim"
          - "Referencing IMAS Data Dictionary (DD), COCOS conventions, or implementation-specific paths"
    
    documentation:
      required: true
      type: string
      format: markdown
      description: "Authoritative, self-contained documentation providing clear, comprehensive explanation of the physical quantity. This field must be fully standalone - a domain expert should understand the quantity completely without consulting external sources."
      guidance:
        imas_data_dictionary:
          purpose: "Use IMAS DD tools to discover context and ensure consistency"
          tools:
            search_imas: "Find relevant DD paths for structural understanding"
            fetch_imas_paths: "Extract authoritative descriptions, units, coordinates, and documentation"
            explore_relationships: "Discover related quantities for inline links (omit max_depth for full cross-IDS discovery)"
          inline_links_discovery:
            tool: "explore_relationships"
            approach: "Query relevant DD leaf paths, omit max_depth parameter for full cross-IDS discovery"
            target: "4-8 inline links per entry distributed throughout documentation"
        tokamak_parameters:
          purpose: "Access authoritative machine parameters for typical values in documentation"
          tools:
            get_tokamak_parameters: "Retrieve verified geometry and physics parameters for tokamak machines"
          usage:
            single_machine: "get_tokamak_parameters(machines='ITER') - Returns full parameter set for one machine"
            multiple_machines: "get_tokamak_parameters(machines='ITER JET DIII-D') - Returns full data plus statistics (min/max/mean/median)"
            all_machines: "get_tokamak_parameters(machines='all') - Returns all machines with statistics"
          examples:
            - "ITER major radius: get_tokamak_parameters(machines='ITER')"
            - "Compare JET and DIII-D: get_tokamak_parameters(machines='JET DIII-D')"
            - "Parameter ranges across all machines: get_tokamak_parameters(machines='all')"
          note: "Always cite specific machines in 'Typical values' sections. Use statistics for parameter ranges."
        structure_templates:
          opening_paragraph:
            content: "Clear definition of the quantity with physics context"
            inline_links: "None - focus on clarity"
            length: "2-4 sentences"
          subsequent_sections:
            preferred_order:
              - "Governing equations ($$...$$)"
              - "Physical significance (include 2-3 inline links here)"
              - "Measurement/Calculation methods (2-3 inline links)"
              - "Typical values with context"
              - "Sign convention (as final paragraph if applicable)"
            section_labels:
              format: "Plain text with colon, no formatting"
              examples: ["Physical significance:", "Measurement methods:", "Typical values:"]
              avoid: ["**Physical significance:**", "PHYSICAL SIGNIFICANCE"]
          inline_links:
            format: "[standard_name](#standard_name)"
            distribution: "Throughout documentation after opening, not in opening"
            target_count: "4-8 for scalar/vector, 3-5 for metadata"
        quality_targets:
          word_count: "150-400 words for scalar/vector, 120-300 for metadata"
          equations: "At least one display equation ($$...$$) for physics quantities"
          typical_values: "Required with context-specific ranges"
        must_include:
          - "Physical interpretation and governing physics"
          - "Governing equations with full definitions (use display equations for main formulas)"
          - "Measurement or derivation methods"
          - "Typical values and physical ranges (populate validity_domain and constraints fields when applicable)"
          - "Coordinate system definitions and sign conventions (if applicable)"
          - "Relationships to other quantities with explicit equations"
        yaml_formatting:
          style: "Use literal block scalar style with pipe (|) for multiline content. This preserves formatting and requires no escaping."
          example: |
            documentation: |
              First paragraph with inline LaTeX $T_e$ and display equations:
              
              $$\nabla \times \mathbf{B} = \mu_0 \mathbf{J}$$
              
              Second paragraph continues here.
        inline_links:
          description: "Reference related standard names using markdown link format [standard_name](#standard_name) for machine-readable cross-references within documentation text"
          format: "[standard_name_token](#standard_name_token)"
          examples:
            - "The electron temperature [electron_temperature](#electron_temperature) is related to electron pressure [electron_pressure](#electron_pressure) via the ideal gas law."
            - "This quantity is the radial component of the magnetic field vector [magnetic_field](#magnetic_field)."
            - "See also [ion_temperature](#ion_temperature) and [electron_density](#electron_density) for related plasma parameters."
          validation: "Referenced names are validated against catalog when entry is created"
          note: "Use inline links for narrative cross-references; use links field for formal dependency declarations"
        equations:
          inline_math: "Use $...$ for inline equations (e.g., $T_e$, $\\nabla p$, $\\mathbf{B}$)"
          display_math: "Use $$...$$ on separate lines for display equations"
          symbols: "Use LaTeX commands ($\\phi$, $\\theta$, $\\rho$), not Unicode characters"
          vectors: "Use $\\mathbf{B}$, $\\mathbf{r}$, $\\mathbf{J}$ notation for vectors"
          requirements:
            - "All variables in equations must be defined either before first use, in a 'where' clause immediately after the equation, or inline when introduced"
            - "Define units for all variables in 'where' clauses or inline definitions"
            - "Ensure dimensional consistency with entry's unit field"
            - "Include only fundamental governing equations - avoid algebraic rearrangements or trivial derivations that don't add physical insight"
          examples:
            - "$V = -N A \\frac{dB}{dt}$ where $V$ is voltage in V, $N$ is number of turns, $A$ is area in m$^2$, $B$ is magnetic field in T"
            - "$\\Phi = \\int \\mathbf{B} \\cdot d\\mathbf{A}$"
            - "$$\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{J}$$"
          unit_consistency:
            rule: "All equations must be dimensionally consistent with the specified unit field"
            requirements:
              - "Clearly specify units for all variables in 'where' clauses or inline definitions"
              - "Ensure the equation resolves to the entry's stated unit when using SI base units"
              - "If showing alternative unit conventions (e.g., eV for temperature), present them separately with explicit conversion factors - never chain inequivalent expressions with equals signs"
            correct_example: "$$p = n k_B T$$ where $n$ is in m$^{-3}$, $k_B$ in J/K, $T$ in K, giving $p$ in Pa"
            incorrect_example: "$$p = n k_B T = n T \\text{ [eV]}$$ (dimensionally inconsistent chain)"
            alternative_units: "For alternative conventions, use separate statements: 'When using $T$ in eV, apply conversion: $p = n T \\times 1.602 \\times 10^{-19}$ Pa.'"
        sign_conventions:
          when_applicable: "For quantities with directional or signed interpretations (fields, fluxes, currents, geometric normals)"
          format: "Sign convention must follow the main content as standalone paragraph"
          template: "Sign convention: Positive when [condition]."
          example: "Sign convention: Positive when normal to loop points downward (negative Z direction)."
          requirements:
            - "Plain text (not bold or italic)"
            - "Blank lines before and after"
            - "Cannot be at document start"
            - "Always start with 'Sign convention:' (title case, colon) followed by 'Positive when' or 'Positive [quantity]'"
        formatting:
          wrapping: "Wrap text at ~75-80 characters for readability"
          paragraphs: "Separate paragraphs with blank lines"
          sections: "Use plain section labels (e.g., 'Measurement methods:', 'Physical context:') without bold formatting"
          lists: "Use Markdown lists (-, *) for organization. Do not use bold or italic formatting"
          equations: "Main governing equations should be standalone display equations ($$...$$), not inline"
          trailing_space: "No trailing whitespace on any line"
        avoid:
          - "References to IMAS Data Dictionary (DD) paths or structure"
          - "References to COCOS conventions (define sign conventions explicitly instead)"
          - "Statements like 'see IMAS documentation' or 'refer to [external source]'"
          - "Implementation-specific details"
          - "Vague terms without explicit definitions"
          - "Unicode characters for Greek letters or special symbols (use LaTeX instead)"
          - "Undefined mathematical variables or symbols appearing in equations"
        when_deriving_from_imas_dd: "Extract and expand the physics content, making it standalone. Define all coordinate systems and sign conventions explicitly within the documentation text."
    
    unit:
      required_for: [scalar, vector]
      optional_for: [metadata]
      type: string
      default: ""
      description: "Unit in fused dot-exponent style (auto-corrected to lexicographic token order). Tokens: alphanumerics only; join with '.'; exponents use ^ (e.g. m.s^-2). No '/', '*', or whitespace. Empty string for dimensionless."
      pattern: "^[A-Za-z0-9]+(\\^[+-]?\\d+)?(\\.[A-Za-z0-9]+(\\^[+-]?\\d+)?)*$|^$"
      auto_normalize: true
      examples:
        - "eV"
        - "m"
        - "m.s^-1"
        - "A.m^-2"
        - "m^-3"
        - "1"
      guidance:
        auto_correction:
          enabled: true
          example: "'s^-2.m' -> 'm.s^-2', 'T.A' -> 'A.T'"
          rule: "Tokens sorted lexicographically"
        dimensionless: "Use '1' for dimensionless quantities"
        scalar_vector_requirement: "Required for scalar and vector entries (use '1' if dimensionless)"
        metadata_optional: "Optional for metadata entries (default empty string, omitted from serialization)"
    
    tags:
      required: true
      type: array
      items: string
      min_items: 1
      description: "Classification keywords from controlled vocabulary. First element (tags[0]) must be a primary tag defining catalog subdirectory. Remaining elements (tags[1:]) are secondary tags for cross-cutting classification."
      validation_file: "vocabularies/tags.yml"
      guidance:
        critical_rule: "tags[0] must be a primary tag. tags[1:] are secondary tags."
        ordering: "Primary tag first, then secondary tags in order of decreasing specificity"
        validation: "All tags validated against grammar/vocabularies/tags.yml. Validation fails if tags[0] is not a primary tag."
        common_mistake: "Do not put secondary tags like 'cylindrical-coordinates' at position 0. Always start with primary tag."
        examples:
          correct:
            - ["magnetics", "measured", "calibrated", "local-measurement"]
            - ["equilibrium", "spatial-profile", "reconstructed"]
            - ["fundamental", "global-quantity", "time-dependent"]
          wrong:
            - ["cylindrical-coordinates", "magnetics"]
            - ["measured", "magnetics"]
    
    links:
      required: false
      type: array
      items: string
      default: []
      description: "Internal cross-references to related standard names only. Use format 'name:standard_name_token' (e.g., 'name:plasma_boundary'). Internal references are validated against the catalog."
      format: "name:standard_name_token"
      guidance:
        use_for:
          - "Related physical quantities (e.g., components of a vector)"
          - "Base quantities for derived entries (e.g., in provenance)"
          - "Complementary measurements or properties"
          - "Alternative representations"
        do_not_use_for:
          - "IMAS Data Dictionary paths or URLs - DD links to standard names, not reverse"
          - "MCP server endpoints (e.g., https://imas-dd.iter.org/mcp)"
          - "External specifications or DOIs - describe in documentation with context instead"
          - "Implementation paths or tool endpoints"
          - "Diagnostic/hardware configuration URLs"
        critical_rule: "Standard names are authoritative. IMAS DD references standard names. Never link back to DD."
        validation: "Internal 'name:' references are validated against catalog. Names must exist or be created in same batch."
        rationale: "Links field creates machine-readable dependency graph. External resources need human context."
        for_external_resources: "Describe in documentation field with proper context, not as bare links in links field."
        inline_vs_links_field: "Use inline name: references in documentation for narrative cross-references. Use links field for formal machine-readable dependency declarations."
        examples:
          correct:
            - "name:plasma_pressure"
            - "name:magnetic_field"
            - "name:electron_temperature"
          wrong:
            - "https://imas-dd.iter.org/..."
            - "equilibrium/time_slice/profiles_1d/elongation"
            - "https://doi.org/10.1088/..."
    
    status:
      required: false
      type: enum
      default: draft
      values: [draft, active, deprecated, superseded]
      description: "Lifecycle state: draft | active | deprecated | superseded."
      guidance:
        workflow: "Use 'draft' initially; promote to 'active' after validation; set superseded_by when deprecating"
        draft: "New entries under review"
        active: "Validated and recommended for use"
        deprecated: "Discouraged but not replaced; set deprecates field on replacement"
        superseded: "Replaced by newer entry; must set superseded_by field"
    
    kind:
      required: true
      type: enum
      values: [scalar, vector, metadata]
      description: "Discriminator field determining entry type (scalar vs vector vs metadata)"
      guidance:
        scalar: "Physical quantities with single value at each point (most common)"
        vector: "Vector field quantities with directional components"
        metadata: "Definitional entries (boundaries, regions, concepts) - no unit or provenance required"
    
    provenance:
      required: false
      applicable_to: [scalar, vector]
      forbidden_for: [metadata]
      description: "Describes how derived quantities are computed from base quantities"
      note: "Metadata entries are definitional anchors, not derived quantities"
      modes:
        operator:
          description: "Chain of mathematical operators applied to base quantity"
          fields:
            mode: "Literal 'operator' discriminator"
            operators: "List of operator tokens (outermost first, auto-normalized to primitive operators)"
            base: "Standard name of underlying quantity"
            operator_id: "Optional composite operator identifier (e.g., 'laplacian', 'second_time_derivative') if user supplied one"
          examples:
            - "gradient of temperature"
            - "divergence of velocity"
            - "time derivative of current"
            - "curl of magnetic field"
          validation:
            - "Base standard name must exist in catalog or be created in same batch"
            - "Name should match operator pattern (e.g., 'gradient_of_base')"
        reduction:
          description: "Aggregation/reduction over a domain"
          fields:
            mode: "Literal 'reduction' discriminator"
            reduction: "Reduction operation (mean, rms, integral, magnitude, ...)"
            domain: "Domain of reduction (time, volume, flux_surface, none)"
            base: "Standard name of quantity being reduced"
          examples:
            - "time average of density"
            - "volume integral of power"
            - "rms of fluctuations"
            - "flux surface average of pressure"
          validation:
            - "Base standard name must exist in catalog or be created in same batch"
            - "Name should match reduction pattern (e.g., 'time_average_of_base')"
        expression:
          description: "Algebraic expression combining multiple standard names"
          fields:
            mode: "Literal 'expression' discriminator"
            expression: "Free-form expression string (catalog-governed)"
            dependencies: "List of standard names referenced in expression"
          examples:
            - "poloidal_beta = 4 * integral(pressure) / (R0 * mu0 * current^2)"
            - "total_energy = kinetic_energy + potential_energy"
          validation:
            - "All dependencies must exist in catalog or be created in same batch"
    
    validity_domain:
      required: false
      type: string
      default: ""
      description: "Controlled vocabulary region of validity"
      examples:
        - "core_plasma"
        - "edge_plasma"
        - "vacuum"
        - "whole_plasma"
      guidance:
        purpose: "Specify the spatial or operational domain where this quantity is physically valid or typically measured"
        use_when: "The quantity is inherently limited to a specific plasma region or operational regime"
        examples:
          - "core_plasma: for quantities only meaningful in confined plasma region"
          - "edge_plasma: for edge/pedestal region specific quantities"
          - "vacuum: for quantities in vacuum regions only"
          - "whole_plasma: for quantities spanning entire plasma volume"
    
    constraints:
      required: false
      type: array
      items: string
      default: []
      description: "Physical or mathematical constraints that must be satisfied (e.g. 'T_e > 0', 'kappa >= 1')"
      examples:
        - ["T_e > 0"]
        - ["n_e >= 0", "n_e < 1e22 m^-3"]
        - ["kappa >= 1"]
      guidance:
        purpose: "Specify hard physical bounds and mathematical constraints on the quantity"
        use_for:
          - "Physical bounds: non-negativity, fundamental limits from physics"
          - "Mathematical constraints: relationships that must hold (e.g., 'elongation >= 1', '0 <= poloidal_beta <= 1')"
          - "Dimensional constraints: valid ranges for dimensionless quantities"
        format: "Use clear mathematical notation with units where applicable"
        note: "Constraints represent hard limits, not typical operational ranges. For typical values, document in a dedicated field or structured metadata (future enhancement)"
        validation: "Constraints are validated for format but not evaluated for physical correctness"
    
    deprecates:
      required: false
      type: string
      default: ""
      description: "Standard name token that this entry deprecates (if promoting replacement)"
      pattern: "^[a-z][a-z0-9_]*$|^$"
    
    superseded_by:
      required: false
      type: string
      default: ""
      description: "Standard name token that supersedes this entry (required when status is 'superseded')"
      pattern: "^[a-z][a-z0-9_]*$|^$"

  # Type-specific requirements
  type_specific:
    scalar:
      required_fields: [name, description, documentation, unit, tags]
      field_overrides:
        unit: "Required (use '1' for dimensionless)"
      optional_fields: [provenance, status, validity_domain, constraints, deprecates, superseded_by, links]
      description: "Physical quantities with single value at each point"
    
    vector:
      required_fields: [name, description, documentation, unit, tags]
      field_overrides:
        unit: "Required (use '1' for dimensionless)"
      optional_fields: [provenance, status, validity_domain, constraints, deprecates, superseded_by, links]
      description: "Vector field quantities with components"
    
    metadata:
      required_fields: [name, description, documentation, tags]
      field_overrides:
        unit: "Optional (default empty string, omitted from serialization)"
      forbidden_fields: [provenance]
      optional_fields: [status, validity_domain, constraints, deprecates, superseded_by, links]
      description: "Definitional entries (boundaries, regions, concepts)"
      note: "Metadata entries are definitional anchors, not measurable/derived quantities"
