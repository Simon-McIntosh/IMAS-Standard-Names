#===============================================================================
# IMAS Standard Name Grammar Specification
#===============================================================================
#
# This file is the single source of truth for the standard-name grammar used by
# the runtime parser and composer. Downstream Python types and metadata are
# auto-generated from this YAML during builds/installs.
#
# Generation details:
# - The generator lives at: imas_standard_names/grammar_codegen/generate.py
# - It writes: imas_standard_names/grammar/types.py
# - It runs automatically during package build via Hatch (see hatch_build_hooks.py)
# - A console entrypoint also exists in pyproject.toml: `build-grammar`
# - You can regenerate locally without building by running:
#     python -m imas_standard_names.grammar_codegen.generate
#
#===============================================================================
# Grammar Usage Notes
#===============================================================================
#
# Segment structure:
# - component/coordinate and subject are optional single tokens; 
#   geometric_base or physical_base is required (mutually exclusive).
#
# component (for physical vectors) vs coordinate (for geometric/spatial vectors):
#   * Use "component" for physical field vectors 
#     (magnetic_field, heat_flux, velocity) with physical_base
#     Template: {axis}_component_of_{vector} 
#     (e.g., radial_component_of_magnetic_field)
#   * Use "coordinate" for geometric/spatial quantities 
#     (position, vertex, centroid, trajectory) with geometric_base
#     Template: {axis}_{geometric_base} 
#     (e.g., radial_position_of_flux_loop_contour)
#   * component and coordinate are mutually exclusive
#   * coordinate requires geometric_base; component requires physical_base
#
# object (of_<object>) vs source (from_<source>):
#   * Use "of_" for intrinsic properties/characteristics OF the hardware/equipment
#     (e.g., major_radius_of_flux_loop, 
#      area_of_poloidal_magnetic_field_probe)
#   * Use "from_" for measurements/signals obtained FROM the hardware 
#     (diagnostic or actuator)
#     (e.g., voltage_from_flux_loop, current_from_poloidal_field_coil)
#   * Same token can be used with both "of_" and "from_" 
#     depending on context
#   * object and source are mutually exclusive
#
# geometry (of_<target>) vs position (at_<location>):
#   * Use "of_" for intrinsic properties/characteristics 
#     OF the geometric object itself
#     (e.g., major_radius_of_plasma_boundary, area_of_first_wall, 
#      curvature_of_flux_surface)
#   * Use "at_" for field quantities evaluated/sampled 
#     AT a spatial location
#     (e.g., electron_temperature_at_magnetic_axis, 
#      poloidal_flux_at_plasma_boundary)
#   * Same token can be used with both "of_" and "at_" 
#     depending on context
#   * geometry and position are mutually exclusive and appear side-by-side 
#     in the suffix order.
#
# Naming conventions:
# - do not include units in the name; use lowercase; start with a letter; 
#   use letters, digits, and underscores.
# - Discourage compound base names (e.g., poloidal_flux_boundary); 
#   prefer explicit position/geometry modifiers
#
#===============================================================================
# Canonical Pattern
#===============================================================================

canonical_pattern: >
  [<component>_component_of | <coordinate>]? [<subject>]? <geometric_base | physical_base> 
  [of_<object> | from_<source>]? 
  [of_<geometry> | at_<position>]? 
  [due_to_<process>]?

#===============================================================================
# Scope: When to Create Standard Names
#===============================================================================

scope:
  include:
    - "Physical measurements and diagnostic signals"
    - "Derived quantities, calculations, and operators"
    - "Hardware geometric/physical properties needed for data interpretation"
    - "Coordinate variables (time, space, flux)"
  exclude:
    - >
      Facility-specific identifiers and labels 
      (paths like */name, */identifier, */label)
    - "Type enumeration indices (paths like */type/index)"
    - "Code provenance metadata (paths like */code/*, */ids_properties/*)"
  rationale: >
    Standard names apply to physical quantities with standardizable meaning and units, 
    not to administrative metadata

#===============================================================================
# Segment Definitions
#===============================================================================

segments:
  - id: component
    optional: true
    vocabulary: components
    template: "{token}_component_of"
    exclusive_with:
      - coordinate
    description: >
      Directional component of a physical vector quantity 
      (fields, fluxes, velocities)
  - id: coordinate
    optional: true
    vocabulary: components
    template: "{token}"
    exclusive_with:
      - component
    description: >
      Coordinate axis for geometric/spatial vector decomposition 
      (position, vertex, centroid, trajectory, displacement)
  - id: subject
    optional: true
    vocabulary: subjects
    description: "Particle species or plasma population"
  - id: geometric_base
    optional: true
    vocabulary: geometric_bases
    exclusive_with:
      - physical_base
    description: >
      Geometric/spatial quantity describing locations, shapes, orientations, or spatial extents.
      Controlled vocabulary of geometric bases that represent WHERE something is or 
      the geometric structure of objects (position, vertex, centroid, displacement, etc.).
      Must be qualified with object or geometry segment to specify what is being described.
      Used with coordinate prefix for vector components (e.g., radial_position_of_flux_loop).
  - id: physical_base
    optional: true
    exclusive_with:
      - geometric_base
    description: >
      Physical quantity, measurement, or hardware property (open-ended).
      Can represent physical fields (magnetic_field, temperature, voltage, flux, current),
      derived quantities (gradient, divergence), measurement signals, 
      or hardware characteristics (area, resistance, capacitance).
      New physical base terms are defined through catalog entries, not the grammar.
      Used with component prefix for physical vector components (e.g., radial_component_of_magnetic_field).
  - id: object
    optional: true
    vocabulary: objects
    template: "of_{token}"
    exclusive_with:
      - source
    description: >
      Physical object, diagnostic hardware, or equipment 
      whose intrinsic property is described
  - id: source
    optional: true
    vocabulary: sources
    template: "from_{token}"
    exclusive_with:
      - object
    description: >
      Physical hardware or device (diagnostic or actuator) 
      from which measurement or signal is obtained
  - id: geometry
    optional: true
    vocabulary: positions
    template: "of_{token}"
    exclusive_with:
      - position
    description: >
      Intrinsic geometric property OF the object 
      (coordinates, dimensions, shapes that define it)
  - id: position
    optional: true
    vocabulary: positions
    template: "at_{token}"
    exclusive_with:
      - geometry
    description: >
      Field quantity evaluated AT the spatial location 
      (temperatures, densities, fluxes measured there)
  - id: process
    optional: true
    vocabulary: processes
    template: "due_to_{token}"
    description: "Physical mechanism or process contributing to the quantity"

#===============================================================================
# Vocabulary Sources
#===============================================================================
# Vocabularies can be defined inline or imported from external files
# External vocabulary files are in the vocabularies/ subdirectory

vocabularies:
  components: !include vocabularies/components.yml
  subjects: !include vocabularies/subjects.yml
  geometric_bases: !include vocabularies/geometric_bases.yml
  objects: !include vocabularies/objects.yml
  sources: !include vocabularies/source.yml
  positions: !include vocabularies/positions.yml
  processes: !include vocabularies/processes.yml
